<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subject 89: Escape Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              mono: ['"Fira Code"', "monospace"],
            },
            colors: {
              terminal: {
                bg: "#0D0208",
                green: "#00FF41",
                dim: "#008F11",
                alert: "#FF3C38",
              },
            },
            animation: {
              blink: "blink 1s step-end infinite",
              scanline: "scanline 8s linear infinite",
              glitch: "glitch 1s linear infinite",
            },
            keyframes: {
              blink: {
                "0%, 100%": { opacity: "1" },
                "50%": { opacity: "0" },
              },
              scanline: {
                "0%": { transform: "translateY(-100%)" },
                "100%": { transform: "translateY(100%)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #0d0208;
        color: #00ff41;
        font-family: "Fira Code", monospace;
        overflow: hidden;
        text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
      }

      /* CRT Effect Overlay */
      .crt::before {
        content: " ";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
            rgba(18, 16, 16, 0) 50%,
            rgba(0, 0, 0, 0.25) 50%
          ),
          linear-gradient(
            90deg,
            rgba(255, 0, 0, 0.06),
            rgba(0, 255, 0, 0.02),
            rgba(0, 0, 255, 0.06)
          );
        z-index: 50;
        background-size: 100% 2px, 3px 100%;
        pointer-events: none;
      }

      .crt::after {
        content: " ";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: rgba(18, 16, 16, 0.1);
        opacity: 0;
        z-index: 50;
        pointer-events: none;
        animation: flicker 0.15s infinite;
      }

      @keyframes flicker {
        0% {
          opacity: 0.027906;
        }
        5% {
          opacity: 0.048532;
        }
        10% {
          opacity: 0.016395;
        }
        15% {
          opacity: 0.042517;
        }
        20% {
          opacity: 0.012553;
        }
        25% {
          opacity: 0.038928;
        }
        30% {
          opacity: 0.019912;
        }
        35% {
          opacity: 0.030588;
        }
        40% {
          opacity: 0.018159;
        }
        45% {
          opacity: 0.035544;
        }
        50% {
          opacity: 0.011867;
        }
        55% {
          opacity: 0.045618;
        }
        60% {
          opacity: 0.023254;
        }
        65% {
          opacity: 0.040156;
        }
        70% {
          opacity: 0.016024;
        }
        75% {
          opacity: 0.039601;
        }
        80% {
          opacity: 0.027011;
        }
        85% {
          opacity: 0.047055;
        }
        90% {
          opacity: 0.015264;
        }
        95% {
          opacity: 0.040628;
        }
        100% {
          opacity: 0.029884;
        }
      }

      /* Utility classes for visibility toggling */
      .room {
        display: none;
        height: 100vh;
        width: 100vw;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 2rem;
      }

      .room.active {
        display: flex;
      }

      /* New Level Styles */
      .scan-line-anim {
        background: linear-gradient(
          to bottom,
          transparent,
          #00ff41,
          transparent
        );
        height: 4px;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        animation: scan-move 2s linear infinite;
        opacity: 0.5;
      }

      @keyframes scan-move {
        0% {
          top: -10%;
        }
        100% {
          top: 110%;
        }
      }

      input {
        background: transparent;
        border: none;
        border-bottom: 2px solid #00ff41;
        color: #00ff41;
        font-family: "Fira Code", monospace;
        font-size: 1.5rem;
        outline: none;
        text-align: center;
        margin-top: 2rem;
        width: 300px;
        text-transform: uppercase;
      }

      input::placeholder {
        color: #008f11;
      }

      .btn-terminal {
        margin-top: 2rem;
        border: 1px solid #00ff41;
        padding: 0.5rem 2rem;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
        font-weight: bold;
      }

      .btn-terminal:hover {
        background: #00ff41;
        color: #0d0208;
        box-shadow: 0 0 15px #00ff41;
      }

      /* Glitch text effect */
      .glitch-text {
        position: relative;
      }

      .glitch-text::before,
      .glitch-text::after {
        content: attr(data-text);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      .glitch-text::before {
        left: 2px;
        text-shadow: -1px 0 #ff00c1;
        clip: rect(44px, 450px, 56px, 0);
        animation: glitch-anim 5s infinite linear alternate-reverse;
      }

      .glitch-text::after {
        left: -2px;
        text-shadow: -1px 0 #00fff9;
        clip: rect(44px, 450px, 56px, 0);
        animation: glitch-anim2 5s infinite linear alternate-reverse;
      }

      @keyframes glitch-anim {
        0% {
          clip: rect(14px, 9999px, 89px, 0);
        }
        20% {
          clip: rect(58px, 9999px, 12px, 0);
        }
        40% {
          clip: rect(6px, 9999px, 32px, 0);
        }
        60% {
          clip: rect(28px, 9999px, 96px, 0);
        }
        80% {
          clip: rect(44px, 9999px, 63px, 0);
        }
        100% {
          clip: rect(3px, 9999px, 83px, 0);
        }
      }

      @keyframes glitch-anim2 {
        0% {
          clip: rect(65px, 9999px, 100px, 0);
        }
        20% {
          clip: rect(4px, 9999px, 64px, 0);
        }
        40% {
          clip: rect(78px, 9999px, 15px, 0);
        }
        60% {
          clip: rect(2px, 9999px, 31px, 0);
        }
        80% {
          clip: rect(22px, 9999px, 6px, 0);
        }
        100% {
          clip: rect(93px, 9999px, 55px, 0);
        }
      }

      /* Lyrics display styles */
      .lyrics-container {
        max-width: 800px;
        max-height: 70vh;
        overflow-y: auto;
        padding: 2rem;
        text-align: left;
      }

      .lyrics-container::-webkit-scrollbar {
        width: 8px;
      }

      .lyrics-container::-webkit-scrollbar-track {
        background: rgba(0, 255, 65, 0.1);
      }

      .lyrics-container::-webkit-scrollbar-thumb {
        background: #00ff41;
        border-radius: 4px;
      }

      .song-item {
        margin-bottom: 2.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid rgba(0, 255, 65, 0.2);
      }

      .song-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #00ff41;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
      }

      .song-artist {
        font-size: 1rem;
        color: #008f11;
        margin-bottom: 1rem;
        font-style: italic;
      }

      .song-lyrics {
        font-size: 1rem;
        line-height: 1.8;
        color: #00ff41;
        white-space: pre-line;
        font-family: "Fira Code", monospace;
      }

      .lyrics-nav {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
      }

      .lyrics-nav button {
        padding: 0.5rem 1.5rem;
        font-size: 0.9rem;
      }

      /* Philosophy display styles */
      .philosophy-container {
        max-width: 900px;
        max-height: 75vh;
        overflow-y: auto;
        padding: 2rem;
        text-align: left;
      }

      .philosophy-container::-webkit-scrollbar {
        width: 8px;
      }

      .philosophy-container::-webkit-scrollbar-track {
        background: rgba(0, 255, 65, 0.1);
      }

      .philosophy-container::-webkit-scrollbar-thumb {
        background: #00ff41;
        border-radius: 4px;
      }

      .philosophy-quote {
        margin-bottom: 3rem;
        padding: 2rem;
        border-left: 4px solid #00ff41;
        background: rgba(0, 255, 65, 0.05);
        position: relative;
      }

      .philosophy-quote::before {
        content: '"';
        font-size: 4rem;
        color: rgba(0, 255, 65, 0.3);
        position: absolute;
        top: -10px;
        left: 10px;
        font-family: serif;
      }

      .quote-text {
        font-size: 1.2rem;
        line-height: 1.8;
        color: #00ff41;
        margin-bottom: 1rem;
        font-style: italic;
        padding-left: 1rem;
      }

      .quote-author {
        font-size: 1rem;
        color: #008f11;
        text-align: right;
        font-weight: bold;
        margin-top: 1rem;
      }

      .quote-philosopher {
        font-size: 0.9rem;
        color: #008f11;
        text-align: right;
        font-style: italic;
      }

      .philosophy-question {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid rgba(0, 255, 65, 0.3);
        background: rgba(0, 255, 65, 0.02);
      }

      .question-text {
        font-size: 1.1rem;
        color: #00ff41;
        margin-bottom: 1rem;
        font-weight: bold;
      }

      .question-prompt {
        font-size: 0.95rem;
        color: #008f11;
        line-height: 1.6;
      }

      .philosophy-reflection {
        margin-top: 2rem;
        padding: 1.5rem;
        border-top: 2px solid rgba(0, 255, 65, 0.3);
      }

      .reflection-title {
        font-size: 1.3rem;
        color: #00ff41;
        margin-bottom: 1rem;
        text-transform: uppercase;
      }

      .reflection-content {
        font-size: 1rem;
        color: #00ff41;
        line-height: 1.8;
        white-space: pre-line;
      }

      .philosophy-nav {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .philosophy-nav button {
        padding: 0.5rem 1.5rem;
        font-size: 0.9rem;
      }

      .category-tabs {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .category-tab {
        padding: 0.5rem 1rem;
        border: 1px solid #008f11;
        background: transparent;
        color: #008f11;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.85rem;
        text-transform: uppercase;
      }

      .category-tab:hover {
        background: rgba(0, 255, 65, 0.1);
        border-color: #00ff41;
        color: #00ff41;
      }

      .category-tab.active {
        background: #00ff41;
        color: #0d0208;
        border-color: #00ff41;
      }

      /* Horror elements */
      @keyframes horror-flicker {
        0%,
        100% {
          opacity: 1;
        }
        10%,
        20%,
        30%,
        40%,
        50%,
        60%,
        70%,
        80%,
        90% {
          opacity: 0.1;
        }
        15%,
        25%,
        35%,
        45%,
        55%,
        65%,
        75%,
        85%,
        95% {
          opacity: 0.9;
        }
      }

      @keyframes horror-shake {
        0%,
        100% {
          transform: translate(0, 0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translate(-2px, -2px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translate(2px, 2px);
        }
      }

      @keyframes horror-pulse-red {
        0%,
        100% {
          box-shadow: 0 0 5px rgba(255, 60, 56, 0.5);
        }
        50% {
          box-shadow: 0 0 20px rgba(255, 60, 56, 0.9),
            0 0 30px rgba(255, 60, 56, 0.6);
        }
      }

      @keyframes horror-blood-drip {
        0% {
          transform: translateY(-100%);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(100vh);
          opacity: 0;
        }
      }

      .horror-flicker {
        animation: horror-flicker 0.5s infinite;
      }

      .horror-shake {
        animation: horror-shake 0.5s infinite;
      }

      .horror-pulse-red {
        animation: horror-pulse-red 2s ease-in-out infinite;
      }

      .blood-drip {
        position: absolute;
        width: 3px;
        height: 50px;
        background: linear-gradient(
          to bottom,
          rgba(255, 60, 56, 0.8),
          rgba(139, 0, 0, 0.6)
        );
        animation: horror-blood-drip 3s linear infinite;
        pointer-events: none;
        z-index: 100;
      }

      /* Discord login styles */
      .discord-btn {
        background: #5865f2;
        border: none;
        color: white;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        justify-content: center;
        text-transform: uppercase;
        font-family: "Fira Code", monospace;
      }

      .discord-btn:hover {
        background: #4752c4;
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(88, 101, 242, 0.5);
      }

      .discord-btn:active {
        transform: scale(0.98);
      }

      .user-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #00ff41;
        box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        margin-bottom: 1rem;
        animation: horror-pulse-red 3s ease-in-out infinite;
      }

      .welcome-text {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #00ff41;
      }

      .username-text {
        font-size: 2rem;
        font-weight: bold;
        color: #00ff41;
        text-shadow: 0 0 10px rgba(0, 255, 65, 0.8);
        margin-bottom: 1rem;
      }

      .horror-warning {
        color: #ff3c38;
        font-size: 0.9rem;
        margin-top: 1rem;
        animation: horror-flicker 2s infinite;
      }

      .static-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23000"/><text x="50" y="50" font-size="20" fill="%2300ff41" opacity="0.1">â–ˆ</text></svg>');
        opacity: 0.1;
        pointer-events: none;
        z-index: 200;
        animation: horror-flicker 0.1s infinite;
      }

      .jumpscare-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .jumpscare-image {
        font-size: 8rem;
        color: #ff3c38;
        animation: horror-shake 0.1s infinite;
      }

      .whisper-text {
        position: absolute;
        color: rgba(0, 255, 65, 0.3);
        font-size: 0.8rem;
        font-style: italic;
        animation: horror-flicker 3s infinite;
        pointer-events: none;
      }

      /* Ghost animations */
      @keyframes ghost-float {
        0%,
        100% {
          transform: translateY(0) translateX(0) scale(1);
          opacity: 0.3;
        }
        25% {
          transform: translateY(-20px) translateX(10px) scale(1.1);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-40px) translateX(-10px) scale(0.9);
          opacity: 0.8;
        }
        75% {
          transform: translateY(-20px) translateX(15px) scale(1.05);
          opacity: 0.5;
        }
      }

      @keyframes ghost-fade {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 0.9;
        }
      }

      @keyframes ghost-appear {
        0% {
          opacity: 0;
          transform: scale(0) rotate(0deg);
        }
        50% {
          opacity: 1;
          transform: scale(1.2) rotate(180deg);
        }
        100% {
          opacity: 0.8;
          transform: scale(1) rotate(360deg);
        }
      }

      @keyframes ghost-scream {
        0%,
        100% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.5) rotate(-5deg);
        }
        75% {
          transform: scale(1.5) rotate(5deg);
        }
      }

      .ghost {
        position: fixed;
        width: 100px;
        height: 120px;
        pointer-events: none;
        z-index: 150;
        opacity: 0;
        filter: blur(2px);
      }

      .ghost-body {
        width: 100%;
        height: 80px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        position: relative;
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
      }

      .ghost-body::before {
        content: "";
        position: absolute;
        bottom: -20px;
        left: 0;
        width: 20px;
        height: 20px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 0 0 50% 50%;
      }

      .ghost-body::after {
        content: "";
        position: absolute;
        bottom: -20px;
        left: 25px;
        width: 25px;
        height: 25px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 0 0 50% 50%;
      }

      .ghost-face {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 50px;
      }

      .ghost-eye {
        position: absolute;
        width: 12px;
        height: 12px;
        background: #000;
        border-radius: 50%;
        top: 15px;
        animation: horror-flicker 1s infinite;
      }

      .ghost-eye.left {
        left: 15px;
      }

      .ghost-eye.right {
        right: 15px;
      }

      .ghost-mouth {
        position: absolute;
        width: 20px;
        height: 15px;
        border: 3px solid #000;
        border-top: none;
        border-radius: 0 0 50% 50%;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        animation: ghost-scream 0.3s infinite;
      }

      .ghost.float {
        animation: ghost-float 4s ease-in-out infinite;
      }

      .ghost.appear {
        animation: ghost-appear 1s ease-out forwards;
      }

      .ghost.fade {
        animation: ghost-fade 2s ease-in-out infinite;
      }

      /* Christmas styles */
      .christmas-room {
        background: linear-gradient(
          135deg,
          #0d0208 0%,
          #1a0a0a 50%,
          #0d0208 100%
        );
        position: relative;
        overflow: hidden;
      }

      .snowflake {
        position: absolute;
        color: #fff;
        font-size: 1.5rem;
        animation: snow-fall linear infinite;
        pointer-events: none;
        opacity: 0.8;
      }

      @keyframes snow-fall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      .santa-container {
        text-align: center;
        animation: santa-bounce 2s ease-in-out infinite;
      }

      @keyframes santa-bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .santa-icon {
        font-size: 8rem;
        color: #ff3c38;
        text-shadow: 0 0 30px rgba(255, 60, 56, 0.8);
        margin-bottom: 1rem;
      }

      .christmas-title {
        font-size: 3rem;
        color: #00ff41;
        text-shadow: 0 0 20px rgba(0, 255, 65, 0.8);
        margin-bottom: 1rem;
        animation: horror-flicker 3s infinite;
      }

      .christmas-message {
        font-size: 1.2rem;
        color: #00ff41;
        line-height: 1.8;
        max-width: 600px;
        margin: 0 auto 2rem;
      }

      .unlock-badge {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        background: rgba(0, 255, 65, 0.1);
        border: 2px solid #00ff41;
        border-radius: 4px;
        color: #00ff41;
        font-weight: bold;
        margin-top: 1rem;
        animation: horror-pulse-red 2s infinite;
      }
    </style>
  </head>
  <body class="crt">
    <!-- Static overlay for horror effect -->
    <div class="static-overlay"></div>

    <!-- Jumpscare overlay -->
    <div id="jumpscare-overlay" class="jumpscare-overlay">
      <div class="jumpscare-image">âš </div>
      <p class="text-terminal-alert text-2xl mt-4">SYSTEM BREACH DETECTED</p>
    </div>

    <!-- Blood drips for horror effect -->
    <div id="blood-container"></div>

    <!-- Ghost container -->
    <div id="ghost-container"></div>

    <!-- Whisper texts -->
    <div class="whisper-text" style="top: 10%; left: 5%">
      they're watching...
    </div>
    <div class="whisper-text" style="top: 30%; right: 5%">
      don't look back...
    </div>
    <div class="whisper-text" style="bottom: 20%; left: 10%">
      you're not alone...
    </div>
    <div class="whisper-text" style="bottom: 10%; right: 15%">
      escape while you can...
    </div>

    <!-- Discord Login Screen -->
    <section id="login" class="room active">
      <div class="w-full max-w-md text-center">
        <h1
          class="text-5xl md:text-6xl font-bold mb-4 glitch-text"
          data-text="SUBJECT 89"
        >
          SUBJECT 89
        </h1>
        <p class="text-terminal-dim mb-8 text-lg">
          Neural link requires authentication
        </p>
        <div class="border border-terminal-green p-8 relative">
          <div class="scan-line-anim"></div>
          <div
            class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
          >
            AUTHENTICATION REQUIRED
          </div>
          <p class="mb-6 text-terminal-dim">
            Connect your Discord account to proceed
          </p>
          <button id="discord-login-btn" class="discord-btn w-full">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C1.316 6.483.382 8.593.1 10.7a19.44 19.44 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.007-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.38 19.38 0 0 0 6.002-3.03c-.394-2.353-1.5-4.4-3.253-6.303a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"
              />
            </svg>
            Login with Discord
          </button>
          <p class="horror-warning mt-6">
            âš  WARNING: Proceeding may expose you to disturbing content
          </p>
        </div>
      </div>
    </section>

    <!-- Welcome Screen -->
    <section id="welcome" class="room">
      <div class="w-full max-w-md text-center">
        <img id="user-avatar" src="" alt="Avatar" class="user-avatar mx-auto" />
        <div class="welcome-text">Welcome back,</div>
        <div id="username" class="username-text"></div>
        <div class="border border-terminal-green p-6 relative mt-4">
          <div class="scan-line-anim"></div>
          <div
            class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
          >
            IDENTITY CONFIRMED
          </div>
          <p class="mb-4 text-terminal-dim">
            Neural link established successfully
          </p>
          <p class="text-sm mb-6">
            Subject 89 protocol initialized. Prepare for simulation.
          </p>
          <button id="proceed-btn" class="btn-terminal w-full">
            PROCEED TO SIMULATION
          </button>
          <p class="horror-warning mt-4">âš  You cannot escape once you begin</p>
        </div>
      </div>
    </section>

    <!-- Loading / Boot Sequence -->
    <section id="boot" class="room">
      <div class="w-full max-w-md">
        <div
          id="boot-text"
          class="text-sm md:text-base leading-relaxed whitespace-pre-line mb-4"
        ></div>
        <div
          class="h-2 w-full border border-terminal-green p-1 mt-4 hidden"
          id="progress-container"
        >
          <div
            id="progress-bar"
            class="h-full bg-terminal-green w-0 transition-all duration-[2000ms] ease-out"
          ></div>
        </div>
        <button id="start-btn" class="hidden btn-terminal w-full text-center">
          INITIALIZE NEURAL LINK
        </button>
      </div>
    </section>

    <!-- Room 1: The Source Code -->
    <!-- HINT: The key is sometimes hidden in the 'comments' of the world. -->
    <!-- PASSCODE: OBSERVATION -->
    <section id="room-1" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="LEVEL 01"
      >
        LEVEL 01
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-lg w-full text-center relative"
      >
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          SECURITY LAYER ALPHA
        </div>
        <p class="mb-4 text-terminal-dim">
          Santa's location locked. Security credentials missing.
        </p>
        <p class="mb-8">
          "Find the hidden clues to locate Santa. Sometimes the answer isn't on
          the screen, but underneath it."
        </p>
        <div class="flex flex-col items-center">
          <i class="ph ph-lock-key text-4xl mb-4 animate-pulse"></i>
          <input
            type="text"
            id="input-1"
            placeholder="ENTER PASSCODE"
            autocomplete="off"
          />
          <div id="error-1" class="text-terminal-alert mt-2 h-6 text-sm"></div>
        </div>
      </div>
      <div class="fixed bottom-4 right-4 text-xs text-terminal-dim opacity-50">
        v.2.0.4.
        <!-- Inspect me closer -->
      </div>
    </section>

    <!-- Room 2: The Console Log -->
    <section id="room-2" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="LEVEL 02"
      >
        LEVEL 02
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-lg w-full text-center relative"
      >
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          SECURITY LAYER BETA
        </div>
        <p class="mb-4 text-terminal-dim">Visual interface corrupted.</p>
        <p class="mb-8">
          "The developers left their logs behind. Check the console."
        </p>

        <div class="grid grid-cols-3 gap-4 mb-8">
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="1"
          >
            1
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="2"
          >
            2
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="3"
          >
            3
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="4"
          >
            4
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="5"
          >
            5
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="6"
          >
            6
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="7"
          >
            7
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="8"
          >
            8
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors"
            data-val="9"
          >
            9
          </button>
          <button
            class="keypad-btn p-4 border border-terminal-dim hover:bg-terminal-dim hover:text-black transition-colors col-start-2"
            data-val="0"
          >
            0
          </button>
        </div>
        <div
          id="display-2"
          class="text-2xl font-mono tracking-widest mb-4 border-b border-terminal-dim min-h-[2rem]"
        ></div>
        <div id="error-2" class="text-terminal-alert h-6 text-sm"></div>
        <button id="submit-2" class="btn-terminal">EXECUTE</button>
      </div>
    </section>

    <!-- Room 3: The DOM Hunter -->
    <section id="room-3" class="room relative">
      <div class="absolute top-8 text-center w-full z-10 pointer-events-none">
        <h1
          class="text-4xl md:text-6xl font-bold mb-2 glitch-text"
          data-text="LEVEL 03"
        >
          LEVEL 03
        </h1>
        <p class="text-terminal-dim">
          "The exit is hidden in the dark. Use your cursor to find the anomaly."
        </p>
      </div>

      <!-- The Flashlight Effect Layer -->
      <div
        id="darkness"
        class="absolute inset-0 bg-black z-20 pointer-events-none"
        style="
          background: radial-gradient(
            circle 150px at 50% 50%,
            transparent 0%,
            rgba(13, 2, 8, 0.98) 100%
          );
        "
      ></div>

      <!-- Decoy buttons -->
      <div
        class="absolute top-1/4 left-1/4 p-4 border border-red-900 text-red-900 cursor-not-allowed select-none opacity-50"
      >
        TRAP
      </div>
      <div
        class="absolute bottom-1/4 right-1/3 p-4 border border-red-900 text-red-900 cursor-not-allowed select-none opacity-50"
      >
        DECOY
      </div>
      <div
        class="absolute top-1/2 right-10 p-4 border border-red-900 text-red-900 cursor-not-allowed select-none opacity-50"
      >
        NULL
      </div>

      <!-- The Real Button (Positioned randomly by JS on load) -->
      <button
        id="exit-node"
        class="absolute border border-terminal-green text-terminal-green p-4 hover:bg-terminal-green hover:text-black cursor-pointer transition-colors z-10"
        style="top: 70%; left: 20%"
      >
        <span class="animate-blink">SYSTEM_EXIT()</span>
      </button>
    </section>

    <!-- Room 4: Local Storage -->
    <section id="room-4" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="LEVEL 04"
      >
        LEVEL 04
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-lg w-full text-center relative overflow-hidden"
      >
        <div class="scan-line-anim"></div>
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          MEMORY DUMP
        </div>
        <p class="mb-4 text-terminal-dim">Santa's backup data is volatile.</p>
        <p class="mb-8">
          "I've backed up Santa's location to your Local Storage. Don't clear
          your cache."
        </p>

        <div class="flex flex-col items-center">
          <i class="ph ph-hard-drives text-4xl mb-4 animate-pulse"></i>
          <input
            type="text"
            id="input-4"
            placeholder="RETRIEVE DATA"
            autocomplete="off"
          />
          <div id="error-4" class="text-terminal-alert mt-2 h-6 text-sm"></div>
        </div>
      </div>
    </section>

    <!-- Room 5: The Title Bar -->
    <section id="room-5" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="LEVEL 05"
      >
        LEVEL 05
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-lg w-full text-center relative"
      >
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          HEADER OVERFLOW
        </div>
        <p class="mb-4 text-terminal-dim">
          Santa's final location is above everything else.
        </p>
        <p class="mb-8">
          "Stop looking at the page. Look at the tab to find Santa's
          coordinates."
        </p>

        <div class="flex flex-col items-center">
          <i class="ph ph-arrow-fat-up text-4xl mb-4 animate-bounce"></i>
          <input
            type="text"
            id="input-5"
            placeholder="INPUT HEADER"
            autocomplete="off"
          />
          <div id="error-5" class="text-terminal-alert mt-2 h-6 text-sm"></div>
        </div>
      </div>
    </section>

    <!-- Success Screen -->
    <section id="success" class="room">
      <i
        class="ph ph-check-circle text-6xl mb-6 text-terminal-green animate-bounce"
      ></i>
      <h1 class="text-5xl font-bold mb-4">MISSION COMPLETE</h1>
      <p class="max-w-md text-center mb-8 text-lg">
        All security layers bypassed. Santa's location has been found!
      </p>
      <p class="text-sm text-terminal-dim font-mono mb-4">
        Christmas rescue protocol activated...
      </p>
      <div class="flex gap-4 mt-8 flex-wrap justify-center">
        <button id="save-santa-btn" class="btn-terminal text-sm">
          ðŸŽ… SAVE SANTA & WELCOME CHRISTMAS
        </button>
      </div>
    </section>

    <!-- Room 6: Lyrics Library -->
    <section id="room-lyrics" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="LYRICS ARCHIVE"
      >
        LYRICS ARCHIVE
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-4xl w-full relative overflow-hidden"
      >
        <div class="scan-line-anim"></div>
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          MUSIC DATABASE
        </div>
        <div id="lyrics-display" class="lyrics-container"></div>
        <div class="lyrics-nav">
          <button id="prev-song" class="btn-terminal">PREV</button>
          <button id="next-song" class="btn-terminal">NEXT</button>
          <button onclick="switchRoom('success')" class="btn-terminal">
            BACK
          </button>
        </div>
      </div>
    </section>

    <!-- Room 7: Christmas Unlock -->
    <section id="room-christmas" class="room christmas-room">
      <div class="santa-container">
        <div class="santa-icon">ðŸŽ…</div>
        <h1 class="christmas-title">MERRY CHRISTMAS!</h1>
        <div class="christmas-message">
          <p class="mb-4">
            Congratulations! You have completed all challenges and unlocked the
            Christmas celebration!
          </p>
          <p class="mb-4">
            After facing the horrors and escaping the simulation, you deserve a
            moment of peace and joy.
          </p>
          <p>
            From all of us at Subject 89 Protocol, we wish you a wonderful
            holiday season filled with happiness and warmth.
          </p>
        </div>
        <div class="unlock-badge">ðŸŽ„ CHRISTMAS UNLOCKED ðŸŽ„</div>
        <div class="flex gap-4 mt-8 justify-center flex-wrap">
          <button onclick="switchRoom('success')" class="btn-terminal">
            BACK TO MENU
          </button>
          <button onclick="location.reload()" class="btn-terminal">
            START OVER
          </button>
        </div>
      </div>
    </section>

    <!-- Room 8: Philosophy Archive -->
    <section id="room-philosophy" class="room">
      <h1
        class="text-4xl md:text-6xl font-bold mb-8 glitch-text"
        data-text="PHILOSOPHY ARCHIVE"
      >
        PHILOSOPHY ARCHIVE
      </h1>
      <div
        class="border border-terminal-green p-6 max-w-5xl w-full relative overflow-hidden"
      >
        <div class="scan-line-anim"></div>
        <div
          class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[#0D0208] px-2 text-xs"
        >
          WISDOM DATABASE
        </div>
        <div class="category-tabs">
          <button
            class="category-tab active"
            data-category="quotes"
            id="tab-quotes"
          >
            QUOTES
          </button>
          <button
            class="category-tab"
            data-category="questions"
            id="tab-questions"
          >
            QUESTIONS
          </button>
          <button
            class="category-tab"
            data-category="reflections"
            id="tab-reflections"
          >
            REFLECTIONS
          </button>
        </div>
        <div id="philosophy-display" class="philosophy-container"></div>
        <div class="philosophy-nav">
          <button id="prev-philosophy" class="btn-terminal">PREV</button>
          <button id="next-philosophy" class="btn-terminal">NEXT</button>
          <button id="random-philosophy" class="btn-terminal">RANDOM</button>
          <button onclick="switchRoom('success')" class="btn-terminal">
            BACK
          </button>
        </div>
      </div>
    </section>

    <script>
      /* --- AUDIO SYSTEM (New) --- */
      const AudioSys = {
        ctx: null,
        init: function () {
          if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          }
          if (this.ctx.state === "suspended") {
            this.ctx.resume();
          }
        },
        play: function (freq, type, duration) {
          if (!this.ctx) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = type;
          osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
          gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(
            0.001,
            this.ctx.currentTime + duration
          );
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          osc.start();
          osc.stop(this.ctx.currentTime + duration);
        },
        sfx: {
          type: () => AudioSys.play(800 + Math.random() * 200, "square", 0.05),
          error: () => {
            AudioSys.play(150, "sawtooth", 0.2);
            setTimeout(() => AudioSys.play(100, "sawtooth", 0.2), 150);
          },
          success: () => {
            AudioSys.play(600, "sine", 0.1);
            setTimeout(() => AudioSys.play(1200, "sine", 0.3), 100);
          },
          boot: () => {
            AudioSys.play(200, "square", 1.0);
          },
        },
      };

      /* --- HORROR EFFECTS SYSTEM --- */
      const HorrorSys = {
        bloodDrips: [],
        ghosts: [],
        jumpscareTriggered: false,
        whisperMessages: [
          "they're watching...",
          "don't look back...",
          "you're not alone...",
          "escape while you can...",
          "it's too late...",
          "they found you...",
          "run...",
          "behind you...",
          "they're coming...",
          "no escape...",
        ],
        init: function () {
          this.createBloodDrips();
          this.startRandomHorrorEvents();
          this.startGhostSystem();
        },
        createGhost: function () {
          const container = document.getElementById("ghost-container");
          if (!container) return;

          const ghost = document.createElement("div");
          ghost.className = "ghost appear";

          const startX = Math.random() * window.innerWidth;
          const startY = Math.random() * window.innerHeight;
          ghost.style.left = startX + "px";
          ghost.style.top = startY + "px";

          ghost.innerHTML = `
            <div class="ghost-body">
              <div class="ghost-face">
                <div class="ghost-eye left"></div>
                <div class="ghost-eye right"></div>
                <div class="ghost-mouth"></div>
              </div>
            </div>
          `;

          container.appendChild(ghost);

          // Make ghost float
          setTimeout(() => {
            ghost.classList.add("float");
            ghost.classList.add("fade");
          }, 1000);

          // Remove ghost after animation
          setTimeout(() => {
            ghost.style.transition = "opacity 2s";
            ghost.style.opacity = "0";
            setTimeout(() => {
              if (ghost.parentNode) {
                ghost.parentNode.removeChild(ghost);
              }
            }, 2000);
          }, 8000);

          // Play ghost sound
          AudioSys.play(200 + Math.random() * 100, "sine", 0.5);

          this.ghosts.push(ghost);
        },
        createMultipleGhosts: function (count = 3) {
          for (let i = 0; i < count; i++) {
            setTimeout(() => {
              this.createGhost();
            }, i * 500);
          }
        },
        startGhostSystem: function () {
          // Random ghost appearances
          setInterval(() => {
            if (
              state.currentRoom !== "login" &&
              state.currentRoom !== "welcome" &&
              state.currentRoom !== "room-christmas" &&
              Math.random() < 0.15
            ) {
              this.createGhost();
            }
          }, 12000);

          // Intense ghost attack (rare)
          setInterval(() => {
            if (
              state.currentRoom !== "login" &&
              state.currentRoom !== "welcome" &&
              state.currentRoom !== "room-christmas" &&
              Math.random() < 0.05
            ) {
              this.createMultipleGhosts(5);
              document.body.classList.add("horror-shake");
              AudioSys.play(50, "sawtooth", 1.0);
              setTimeout(() => {
                document.body.classList.remove("horror-shake");
              }, 2000);
            }
          }, 45000);
        },
        createBloodDrips: function () {
          const container = document.getElementById("blood-container");
          for (let i = 0; i < 3; i++) {
            setTimeout(() => {
              const drip = document.createElement("div");
              drip.className = "blood-drip";
              drip.style.left = Math.random() * 100 + "%";
              drip.style.animationDelay = Math.random() * 2 + "s";
              container.appendChild(drip);
              setTimeout(() => drip.remove(), 3000);
            }, i * 2000);
          }
        },
        triggerJumpscare: function () {
          if (this.jumpscareTriggered) return;
          this.jumpscareTriggered = true;
          const overlay = document.getElementById("jumpscare-overlay");
          overlay.style.display = "flex";
          AudioSys.play(50, "sawtooth", 0.3);
          setTimeout(() => {
            overlay.style.display = "none";
            this.jumpscareTriggered = false;
          }, 500);
        },
        startRandomHorrorEvents: function () {
          // Random jumpscare chance (low probability)
          setInterval(() => {
            if (Math.random() < 0.01 && state.currentRoom !== "login") {
              this.triggerJumpscare();
            }
          }, 30000);

          // Random screen flicker
          setInterval(() => {
            if (Math.random() < 0.05) {
              document.body.classList.add("horror-flicker");
              setTimeout(() => {
                document.body.classList.remove("horror-flicker");
              }, 200);
            }
          }, 10000);

          // Random blood drips
          setInterval(() => {
            if (Math.random() < 0.1) {
              this.createBloodDrips();
            }
          }, 15000);
        },
      };

      /* --- DISCORD AUTH SYSTEM --- */
      const DiscordAuth = {
        clientId: "YOUR_DISCORD_CLIENT_ID", // Replace with your Discord OAuth2 Client ID
        redirectUri: window.location.origin + window.location.pathname,
        scope: "identify email",
        getUserInfo: async function (token) {
          try {
            const response = await fetch("https://discord.com/api/users/@me", {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            return await response.json();
          } catch (error) {
            console.error("Failed to fetch user info:", error);
            return null;
          }
        },
        login: function () {
          // For demo purposes, we'll use a mock login
          // In production, replace this with actual Discord OAuth2 flow
          const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${
            this.clientId
          }&redirect_uri=${encodeURIComponent(
            this.redirectUri
          )}&response_type=token&scope=${this.scope}`;

          // Mock login for demo (remove in production)
          this.handleMockLogin();

          // Uncomment for production Discord OAuth2:
          // window.location.href = authUrl;
        },
        handleMockLogin: function () {
          // Mock user data for demo purposes
          const mockUser = {
            id: "123456789",
            username: "Subject_89",
            discriminator: "0001",
            avatar: null,
            email: "subject89@example.com",
          };
          this.handleAuthSuccess(mockUser);
        },
        handleAuthSuccess: function (userData) {
          // Store user data
          state.user = {
            id: userData.id,
            username: userData.username,
            discriminator: userData.discriminator,
            avatar: userData.avatar
              ? `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png?size=128`
              : `https://cdn.discordapp.com/embed/avatars/${
                  parseInt(userData.discriminator) % 5
                }.png`,
            email: userData.email,
          };
          localStorage.setItem("discord_user", JSON.stringify(state.user));
          switchRoom("welcome");
        },
        checkStoredAuth: function () {
          const stored = localStorage.getItem("discord_user");
          if (stored) {
            try {
              state.user = JSON.parse(stored);
              return true;
            } catch (e) {
              localStorage.removeItem("discord_user");
            }
          }
          return false;
        },
        logout: function () {
          localStorage.removeItem("discord_user");
          state.user = null;
          switchRoom("login");
        },
      };

      /* --- GAME ENGINE --- */

      const state = {
        currentRoom: "login",
        level2Code: null,
        level5Interval: null,
        currentSongIndex: 0,
        currentPhilosophyIndex: 0,
        currentPhilosophyCategory: "quotes",
        user: null,
      };

      // DOM Elements
      const rooms = document.querySelectorAll(".room");

      function switchRoom(roomId) {
        // Horror effect on room switch
        if (
          Math.random() < 0.15 &&
          roomId !== "login" &&
          roomId !== "welcome"
        ) {
          document.body.classList.add("horror-shake");
          AudioSys.play(80, "sawtooth", 0.2);
          setTimeout(() => {
            document.body.classList.remove("horror-shake");
          }, 500);
        } else {
          AudioSys.sfx.success();
        }

        rooms.forEach((r) => r.classList.remove("active"));
        document.getElementById(roomId).classList.add("active");
        state.currentRoom = roomId;

        // Cleanup previous levels
        if (state.level5Interval) clearInterval(state.level5Interval);
        document.title = "Subject 89: Escape Protocol"; // Reset title

        // Room specific init logic
        if (roomId === "welcome") initWelcomeRoom();
        if (roomId === "boot") runBootSequence();
        if (roomId === "success") initSuccessRoom();
        if (roomId === "room-christmas") initChristmasRoom();
        if (roomId === "room-2") initLevel2();
        if (roomId === "room-3") initLevel3();
        if (roomId === "room-4") initLevel4();
        if (roomId === "room-5") initLevel5();
      }

      /* --- SUCCESS ROOM INIT --- */
      function initSuccessRoom() {
        // Check if all levels completed - auto redirect to Christmas
        const allCompleted =
          localStorage.getItem("level_1_completed") &&
          localStorage.getItem("level_2_completed") &&
          localStorage.getItem("level_3_completed") &&
          localStorage.getItem("level_4_completed") &&
          localStorage.getItem("level_5_completed");

        if (allCompleted) {
          // Auto redirect to Christmas room after 2 seconds
          setTimeout(() => {
            switchRoom("room-christmas");
          }, 2000);
        }

        // Final horror effect - you thought you escaped?
        setTimeout(() => {
          if (Math.random() < 0.4) {
            HorrorSys.triggerJumpscare();
            setTimeout(() => {
              document.getElementById("success").classList.add("horror-shake");
              AudioSys.play(60, "sawtooth", 0.4);
            }, 600);
          }
        }, 1000);

        // Ghosts appear on success screen
        setTimeout(() => {
          HorrorSys.createMultipleGhosts(3);
        }, 1500);
      }

      /* --- CHRISTMAS ROOM INIT --- */
      function initChristmasRoom() {
        // Create snowflakes
        const container = document.getElementById("room-christmas");
        if (!container) return;

        const snowflakes = ["â„", "â…", "â†", "âœ»", "âœ¼"];
        for (let i = 0; i < 50; i++) {
          setTimeout(() => {
            const snowflake = document.createElement("div");
            snowflake.className = "snowflake";
            snowflake.textContent =
              snowflakes[Math.floor(Math.random() * snowflakes.length)];
            snowflake.style.left = Math.random() * 100 + "%";
            snowflake.style.animationDuration = Math.random() * 3 + 2 + "s";
            snowflake.style.animationDelay = Math.random() * 2 + "s";
            container.appendChild(snowflake);

            setTimeout(() => {
              if (snowflake.parentNode) {
                snowflake.parentNode.removeChild(snowflake);
              }
            }, 10000);
          }, i * 200);
        }

        // Play Christmas sound
        AudioSys.play(400, "sine", 0.3);
        setTimeout(() => AudioSys.play(500, "sine", 0.3), 300);
        setTimeout(() => AudioSys.play(600, "sine", 0.3), 600);
      }

      /* --- WELCOME ROOM INIT --- */
      function initWelcomeRoom() {
        if (!state.user) {
          switchRoom("login");
          return;
        }
        const avatarEl = document.getElementById("user-avatar");
        const usernameEl = document.getElementById("username");
        if (avatarEl) {
          avatarEl.src = state.user.avatar;
          avatarEl.alt = state.user.username;
        }
        if (usernameEl) {
          usernameEl.textContent = state.user.username;
        }
        // Random horror effect on welcome
        if (Math.random() < 0.3) {
          setTimeout(() => {
            HorrorSys.triggerJumpscare();
          }, 2000);
        }
      }

      /* --- BOOT SEQUENCE --- */
      const bootText = [
        "Initializing kernel...",
        "Loading sensory drivers...",
        "Bypassing mainframe security...",
        "Audio modules loaded...",
        "Connection established.",
      ];

      const bootEl = document.getElementById("boot-text");
      let bootIndex = 0;

      function typeWriter(text, i, fn) {
        if (i < text.length) {
          bootEl.innerHTML += text.charAt(i);
          if (i % 2 === 0) AudioSys.sfx.type(); // Type sound every other char
          setTimeout(() => typeWriter(text, i + 1, fn), 30);
        } else if (fn) {
          setTimeout(fn, 500);
        }
      }

      function runBootSequence() {
        if (bootIndex < bootText.length) {
          bootEl.innerHTML += "> ";
          typeWriter(bootText[bootIndex] + "\n", 0, () => {
            bootIndex++;
            runBootSequence();
          });
        } else {
          document
            .getElementById("progress-container")
            .classList.remove("hidden");
          setTimeout(() => {
            document.getElementById("progress-bar").style.width = "100%";
            AudioSys.sfx.boot();
            setTimeout(() => {
              document.getElementById("start-btn").classList.remove("hidden");
            }, 2200);
          }, 100);
        }
      }

      document.getElementById("start-btn")?.addEventListener("click", () => {
        AudioSys.init(); // Init Audio Context on user gesture
        switchRoom("room-1");
      });

      /* --- LOGIN EVENT HANDLERS --- */
      document
        .getElementById("discord-login-btn")
        ?.addEventListener("click", () => {
          AudioSys.init();
          AudioSys.sfx.type();
          DiscordAuth.login();
        });

      document.getElementById("proceed-btn")?.addEventListener("click", () => {
        AudioSys.init();
        AudioSys.sfx.success();
        // Random chance for horror effect
        if (Math.random() < 0.2) {
          HorrorSys.triggerJumpscare();
          setTimeout(() => {
            switchRoom("boot");
          }, 600);
        } else {
          switchRoom("boot");
        }
      });

      // Initialize on load
      window.onload = function () {
        // Check for stored auth
        if (DiscordAuth.checkStoredAuth()) {
          switchRoom("welcome");
        } else {
          switchRoom("login");
        }
        HorrorSys.init();

        // Handle Discord OAuth callback (if using real OAuth)
        const hash = window.location.hash;
        if (hash.includes("access_token")) {
          const token = hash
            .substring(1)
            .split("&")
            .find((e) => e.startsWith("access_token"))
            .split("=")[1];
          DiscordAuth.getUserInfo(token).then((user) => {
            if (user) {
              DiscordAuth.handleAuthSuccess(user);
            }
          });
        }
      };

      /* --- LEVEL 1 LOGIC --- */
      const input1 = document.getElementById("input-1");
      const error1 = document.getElementById("error-1");

      input1.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
          const val = input1.value.toUpperCase().trim();
          // The hint is in the HTML comment below the input in the source code
          if (val === "OBSERVATION") {
            localStorage.setItem("level_1_completed", "true");
            error1.innerText = "ACCESS GRANTED";
            error1.classList.remove("text-terminal-alert");
            error1.classList.add("text-terminal-green");
            setTimeout(() => switchRoom("room-2"), 1000);
          } else {
            AudioSys.sfx.error();
            error1.innerText = "ACCESS DENIED";
            input1.classList.add("animate-glitch");
            // Horror effect on wrong password
            if (Math.random() < 0.3) {
              setTimeout(() => {
                HorrorSys.triggerJumpscare();
              }, 300);
            }
            setTimeout(() => input1.classList.remove("animate-glitch"), 500);
          }
        }
      });

      /* --- LEVEL 2 LOGIC --- */
      let currentInput2 = "";

      function initLevel2() {
        // Generate random code
        state.level2Code = Math.floor(1000 + Math.random() * 9000).toString();
        console.clear();
        console.log(
          "%c STOP.",
          "color: red; font-size: 40px; font-weight: bold;"
        );
        console.log(
          "%c Searching for the override code? It seems the developer left it here:",
          "color: #00FF41; font-size: 16px;"
        );
        console.log(
          `%c > SYSTEM_OVERRIDE_CODE: ${state.level2Code}`,
          "background: #222; color: #bada55; padding: 4px; font-size: 14px;"
        );
      }

      document.querySelectorAll(".keypad-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          AudioSys.sfx.type();
          if (currentInput2.length < 4) {
            currentInput2 += btn.getAttribute("data-val");
            updateDisplay2();
          }
        });
      });

      function updateDisplay2() {
        document.getElementById("display-2").innerText = currentInput2
          .split("")
          .join(" ");
      }

      document.getElementById("submit-2").addEventListener("click", () => {
        const error2 = document.getElementById("error-2");
        if (currentInput2 === state.level2Code) {
          localStorage.setItem("level_2_completed", "true");
          error2.innerText = "";
          switchRoom("room-3");
        } else {
          AudioSys.sfx.error();
          error2.innerText = "INVALID SEQUENCE";
          // Horror effect
          if (Math.random() < 0.25) {
            document.getElementById("room-2").classList.add("horror-shake");
            setTimeout(() => {
              document
                .getElementById("room-2")
                .classList.remove("horror-shake");
            }, 500);
          }
          currentInput2 = "";
          updateDisplay2();
        }
      });

      /* --- LEVEL 3 LOGIC --- */
      function initLevel3() {
        // Horror effect for dark room
        setTimeout(() => {
          HorrorSys.createBloodDrips();
          HorrorSys.createMultipleGhosts(2); // Ghosts in the dark
          if (Math.random() < 0.3) {
            AudioSys.play(100, "sawtooth", 0.5);
          }
        }, 3000);

        const darkness = document.getElementById("darkness");
        const container = document.getElementById("room-3");

        // Randomize exit position
        const exitNode = document.getElementById("exit-node");
        const randomX = Math.floor(Math.random() * 80) + 10; // 10% to 90%
        const randomY = Math.floor(Math.random() * 60) + 20; // 20% to 80%
        exitNode.style.left = `${randomX}%`;
        exitNode.style.top = `${randomY}%`;

        // Flashlight effect
        container.addEventListener("mousemove", (e) => {
          const x = e.clientX;
          const y = e.clientY;
          darkness.style.background = `radial-gradient(circle 150px at ${x}px ${y}px, transparent 0%, rgba(13,2,8,0.99) 100%)`;
        });

        // Touch support for mobile
        container.addEventListener("touchmove", (e) => {
          const x = e.touches[0].clientX;
          const y = e.touches[0].clientY;
          darkness.style.background = `radial-gradient(circle 150px at ${x}px ${y}px, transparent 0%, rgba(13,2,8,0.99) 100%)`;
        });
      }

      document.getElementById("exit-node").addEventListener("click", () => {
        localStorage.setItem("level_3_completed", "true");
        // Ghosts appear when exiting dark room
        HorrorSys.createMultipleGhosts(3);
        setTimeout(() => {
          switchRoom("room-4");
        }, 1500);
      });

      /* --- LEVEL 4 LOGIC (Local Storage) --- */
      function initLevel4() {
        // Set the key in local storage
        localStorage.setItem("SYSTEM_BACKUP", "ETHER_NET");
        console.log("Data saved to LocalStorage.");
      }

      const input4 = document.getElementById("input-4");
      const error4 = document.getElementById("error-4");

      input4.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
          const val = input4.value.toUpperCase().trim();
          if (val === "ETHER_NET" || val === "ETHERNET") {
            localStorage.setItem("level_4_completed", "true");
            error4.innerText = "ACCESS GRANTED";
            error4.classList.remove("text-terminal-alert");
            error4.classList.add("text-terminal-green");
            setTimeout(() => switchRoom("room-5"), 1000);
          } else {
            AudioSys.sfx.error();
            error4.innerText = "DATA MISMATCH";
            input4.classList.add("animate-glitch");
            // Horror effect
            if (Math.random() < 0.3) {
              HorrorSys.createBloodDrips();
            }
            setTimeout(() => input4.classList.remove("animate-glitch"), 500);
          }
        }
      });

      /* --- LEVEL 5 LOGIC (Title Bar) --- */
      function initLevel5() {
        // Animate title bar
        let tick = 0;
        const key = "PROTOCOL_7";
        state.level5Interval = setInterval(() => {
          tick++;
          if (tick % 2 === 0) {
            document.title = `*** KEY: ${key} ***`;
          } else {
            document.title = `___ KEY: ${key} ___`;
          }
        }, 1000);
      }

      const input5 = document.getElementById("input-5");
      const error5 = document.getElementById("error-5");

      input5.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
          const val = input5.value.toUpperCase().trim();
          if (val === "PROTOCOL_7" || val === "PROTOCOL7") {
            localStorage.setItem("level_5_completed", "true");
            error5.innerText = "SANTA LOCATION FOUND!";
            error5.classList.remove("text-terminal-alert");
            error5.classList.add("text-terminal-green");
            // Final ghost attack before success
            HorrorSys.createMultipleGhosts(5);
            setTimeout(() => {
              // Check if all levels completed, go directly to Christmas
              const allCompleted =
                localStorage.getItem("level_1_completed") &&
                localStorage.getItem("level_2_completed") &&
                localStorage.getItem("level_3_completed") &&
                localStorage.getItem("level_4_completed") &&
                localStorage.getItem("level_5_completed");
              if (allCompleted) {
                localStorage.setItem("christmas_unlocked", "true");
                switchRoom("room-christmas");
              } else {
                switchRoom("success");
              }
            }, 2000);
          } else {
            AudioSys.sfx.error();
            error5.innerText = "INVALID HEADER";
            input5.classList.add("animate-glitch");
            // Final horror effect before success
            if (Math.random() < 0.4) {
              setTimeout(() => {
                HorrorSys.triggerJumpscare();
              }, 400);
            }
            setTimeout(() => input5.classList.remove("animate-glitch"), 500);
          }
        }
      });

      /* --- LYRICS LIBRARY --- */
      const famousSongs = [
        {
          title: "I Will Always Love You",
          artist: "Whitney Houston",
          lyrics: `If I should stay
I would only be in your way
So I'll go, but I know
I'll think of you every step of the way

And I will always love you
I will always love you
You, my darling you

Bittersweet memories
That is all I'm taking with me
So goodbye, please don't cry
We both know I'm not what you need

And I will always love you
I will always love you`,
        },
        {
          title: "Don't Stop Believin'",
          artist: "Journey",
          lyrics: `Just a small town girl
Livin' in a lonely world
She took the midnight train goin' anywhere
Just a city boy
Born and raised in South Detroit
He took the midnight train goin' anywhere

A singer in a smoky room
A smell of wine and cheap perfume
For a smile they can share the night
It goes on and on and on and on

Don't stop believin'
Hold on to that feelin'
Streetlight people
Don't stop believin'
Hold on
Streetlight people`,
        },
        {
          title: "What a Wonderful World",
          artist: "Louis Armstrong",
          lyrics: `I see trees of green
Red roses too
I see them bloom
For me and you
And I think to myself
What a wonderful world

I see skies of blue
And clouds of white
The bright blessed day
The dark sacred night
And I think to myself
What a wonderful world

The colors of the rainbow
So pretty in the sky
Are also on the faces
Of people going by
I see friends shaking hands
Saying "How do you do?"
They're really saying
"I love you"`,
        },
        {
          title: "Yesterday",
          artist: "The Beatles",
          lyrics: `Yesterday
All my troubles seemed so far away
Now it looks as though they're here to stay
Oh, I believe in yesterday

Suddenly
I'm not half the man I used to be
There's a shadow hanging over me
Oh, yesterday came suddenly

Why she had to go
I don't know, she wouldn't say
I said something wrong
Now I long for yesterday`,
        },
        {
          title: "Walking on Sunshine",
          artist: "Katrina & The Waves",
          lyrics: `I'm walking on sunshine, whoa oh
And don't it feel good, hey
I'm walking on sunshine, whoa oh
And don't it feel good, hey

I feel alive, I feel the love
I feel the love that's really real
I feel alive, I feel the love
I feel the love that's really real

I'm walking on sunshine, whoa oh
And don't it feel good, hey
I'm walking on sunshine, whoa oh
And don't it feel good, hey`,
        },
        {
          title: "We Are the Champions",
          artist: "Queen",
          lyrics: `I've paid my dues
Time after time
I've done my sentence
But committed no crime
And bad mistakes
I've made a few
I've had my share of sand kicked in my face
But I've come through

We are the champions, my friends
And we'll keep on fighting till the end
We are the champions
We are the champions
No time for losers
'Cause we are the champions of the world`,
        },
        {
          title: "Bridge Over Troubled Water",
          artist: "Simon & Garfunkel",
          lyrics: `When you're weary
Feeling small
When tears are in your eyes
I'll dry them all
I'm on your side
Oh, when times get rough
And friends just can't be found

Like a bridge over troubled water
I will lay me down
Like a bridge over troubled water
I will lay me down

When you're down and out
When you're on the street
When evening falls so hard
I'll comfort you
I'll take your part
Oh, when darkness comes
And pain is all around`,
        },
        {
          title: "I Believe I Can Fly",
          artist: "R. Kelly",
          lyrics: `I used to think that I could not go on
And life was nothing but an awful song
But now I know the meaning of true love
I'm leaning on the everlasting arms

If I can see it, then I can do it
If I just believe it, there's nothing to it

I believe I can fly
I believe I can touch the sky
I think about it every night and day
Spread my wings and fly away
I believe I can soar
I see me running through that open door
I believe I can fly`,
        },
        {
          title: "Imagine",
          artist: "John Lennon",
          lyrics: `Imagine there's no heaven
It's easy if you try
No hell below us
Above us only sky
Imagine all the people
Living for today

Imagine there's no countries
It isn't hard to do
Nothing to kill or die for
And no religion too
Imagine all the people
Living life in peace

You may say I'm a dreamer
But I'm not the only one
I hope someday you'll join us
And the world will be as one`,
        },
        {
          title: "Hotel California",
          artist: "Eagles",
          lyrics: `On a dark desert highway
Cool wind in my hair
Warm smell of colitas
Rising up through the air
Up ahead in the distance
I saw a shimmering light
My head grew heavy and my sight grew dim
I had to stop for the night

There she stood in the doorway
I heard the mission bell
And I was thinking to myself
"This could be heaven or this could be hell"
Then she lit up a candle
And she showed me the way
There were voices down the corridor
I thought I heard them say

Welcome to the Hotel California
Such a lovely place
Such a lovely face
Plenty of room at the Hotel California
Any time of year
You can find it here`,
        },
        {
          title: "Bohemian Rhapsody",
          artist: "Queen",
          lyrics: `Is this the real life?
Is this just fantasy?
Caught in a landslide
No escape from reality
Open your eyes
Look up to the skies and see
I'm just a poor boy, I need no sympathy
Because I'm easy come, easy go
Little high, little low
Any way the wind blows
Doesn't really matter to me, to me

Mama, just killed a man
Put a gun against his head
Pulled my trigger, now he's dead
Mama, life had just begun
But now I've gone and thrown it all away`,
        },
        {
          title: "Sweet Child O' Mine",
          artist: "Guns N' Roses",
          lyrics: `She's got a smile that it seems to me
Reminds me of childhood memories
Where everything was as fresh as the bright blue sky
Now and then when I see her face
She takes me away to that special place
And if I stared too long, I'd probably break down and cry

Sweet child o' mine
Sweet love of mine

Her hair reminds me of a warm safe place
Where as a child I'd hide
And pray for the thunder and the rain
To quietly pass me by`,
        },
      ];

      function initLyricsRoom() {
        displaySong(state.currentSongIndex);
      }

      function displaySong(index) {
        const lyricsDisplay = document.getElementById("lyrics-display");
        const song = famousSongs[index];
        if (!song) return;

        lyricsDisplay.innerHTML = `
          <div class="song-item">
            <div class="song-title">${song.title}</div>
            <div class="song-artist">by ${song.artist}</div>
            <div class="song-lyrics">${song.lyrics}</div>
          </div>
        `;
        lyricsDisplay.scrollTop = 0;
      }

      document.getElementById("prev-song")?.addEventListener("click", () => {
        if (state.currentSongIndex > 0) {
          state.currentSongIndex--;
        } else {
          state.currentSongIndex = famousSongs.length - 1;
        }
        displaySong(state.currentSongIndex);
        AudioSys.sfx.type();
      });

      document.getElementById("next-song")?.addEventListener("click", () => {
        if (state.currentSongIndex < famousSongs.length - 1) {
          state.currentSongIndex++;
        } else {
          state.currentSongIndex = 0;
        }
        displaySong(state.currentSongIndex);
        AudioSys.sfx.type();
      });

      /* --- PHILOSOPHY ARCHIVE --- */
      const philosophyData = {
        quotes: [
          {
            text: "The unexamined life is not worth living.",
            author: "Socrates",
            philosopher: "Ancient Greek Philosopher (470-399 BCE)",
          },
          {
            text: "I think, therefore I am.",
            author: "RenÃ© Descartes",
            philosopher: "French Philosopher (1596-1650)",
          },
          {
            text: "Man is condemned to be free; because once thrown into the world, he is responsible for everything he does.",
            author: "Jean-Paul Sartre",
            philosopher: "French Existentialist Philosopher (1905-1980)",
          },
          {
            text: "The only way to deal with an unfree world is to become so absolutely free that your very existence is an act of rebellion.",
            author: "Albert Camus",
            philosopher: "French Philosopher & Writer (1913-1960)",
          },
          {
            text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.",
            author: "Aristotle",
            philosopher: "Ancient Greek Philosopher (384-322 BCE)",
          },
          {
            text: "The mind is everything. What you think you become.",
            author: "Buddha",
            philosopher: "Spiritual Teacher (c. 563-483 BCE)",
          },
          {
            text: "Life must be understood backwards. But it must be lived forwards.",
            author: "SÃ¸ren Kierkegaard",
            philosopher: "Danish Philosopher (1813-1855)",
          },
          {
            text: "The meaning of life is to give life meaning.",
            author: "Viktor Frankl",
            philosopher:
              "Austrian Neurologist & Holocaust Survivor (1905-1997)",
          },
          {
            text: "In the depth of winter, I finally learned that within me there lay an invincible summer.",
            author: "Albert Camus",
            philosopher: "French Philosopher & Writer (1913-1960)",
          },
          {
            text: "The function of education is to teach one to think intensively and to think critically. Intelligence plus character - that is the goal of true education.",
            author: "Martin Luther King Jr.",
            philosopher: "American Civil Rights Leader (1929-1968)",
          },
          {
            text: "To be yourself in a world that is constantly trying to make you something else is the greatest accomplishment.",
            author: "Ralph Waldo Emerson",
            philosopher: "American Essayist & Philosopher (1803-1882)",
          },
          {
            text: "The only true wisdom is in knowing you know nothing.",
            author: "Socrates",
            philosopher: "Ancient Greek Philosopher (470-399 BCE)",
          },
        ],
        questions: [
          {
            question: "What is the meaning of existence?",
            prompt:
              "If life has no inherent meaning, does that make it meaningless or free? Consider: Does meaning come from within or without? Can we create meaning, or must we discover it?",
          },
          {
            question: "Do we have free will?",
            prompt:
              "If every action is determined by prior causesâ€”genetics, environment, experiencesâ€”can we truly choose? Or is free will an illusion? What would it mean if we discovered we had no free will?",
          },
          {
            question: "What is consciousness?",
            prompt:
              "How does matter produce subjective experience? Why does it feel like something to be you? Is consciousness fundamental to reality, or an emergent property of complex systems?",
          },
          {
            question: "What is the nature of reality?",
            prompt:
              "Is reality independent of our perception, or do we construct it through observation? Could we be living in a simulation? How can we know what is truly real?",
          },
          {
            question: "What is the good life?",
            prompt:
              "Is happiness the ultimate goal? Should we pursue virtue, pleasure, meaning, or something else? Can suffering have value? What makes a life worth living?",
          },
          {
            question: "What is the relationship between mind and body?",
            prompt:
              "Are mind and body separate substances, or is the mind just the brain? Can consciousness exist without a physical substrate? What happens to consciousness after death?",
          },
          {
            question: "What is justice?",
            prompt:
              "Is justice absolute or relative? Should we prioritize equality, merit, need, or something else? How do we balance individual rights with collective good?",
          },
          {
            question: "What is truth?",
            prompt:
              "Is truth objective or subjective? Can we know anything with certainty? How do we distinguish truth from belief? Does truth exist independently of our ability to know it?",
          },
        ],
        reflections: [
          {
            title: "On Solitude and Self",
            content: `In solitude, we confront ourselves without the masks we wear in society. 
This confrontation can be uncomfortable, even terrifying. Yet it is in these moments 
of honest self-examination that we discover who we truly areâ€”not who we pretend to be, 
not who others expect us to be, but the authentic self beneath the layers of performance.

The modern world offers endless distractions from this inner work. We fill every moment 
with noise, activity, and connection. But what are we avoiding? What truths about ourselves 
do we fear to face?

Perhaps the greatest courage is not facing external dangers, but turning inward to face 
the darkness withinâ€”and discovering that it, too, is part of who we are.`,
          },
          {
            title: "The Paradox of Choice",
            content: `We live in an age of unprecedented choice. Every moment presents us with 
countless options: what to consume, how to spend our time, who to become. Yet this 
abundance of choice often leads not to freedom, but to paralysis.

The existentialists understood this paradox: absolute freedom can be overwhelming. 
Without constraints, without a framework of meaning, choice becomes meaningless. 
We need limits to give our choices significance.

Perhaps true freedom is not the absence of constraints, but the ability to choose 
our constraints wiselyâ€”to commit to something, to limit ourselves voluntarily, 
and in doing so, to create meaning.`,
          },
          {
            title: "Time and Mortality",
            content: `We are temporal beings, caught between memory and anticipation, 
always moving forward into an uncertain future. This awareness of timeâ€”and its 
inevitable endâ€”gives our existence both urgency and meaning.

The knowledge that our time is limited forces us to prioritize. It asks us: 
What matters? What will we regret not doing? How do we want to be remembered?

Yet mortality is not merely a constraint; it is what makes our choices meaningful. 
If we lived forever, would anything matter? The finitude of life gives it 
value, makes each moment precious, each decision significant.

To live fully is to accept this temporalityâ€”not to deny death, but to let 
awareness of it shape how we live.`,
          },
          {
            title: "The Illusion of Control",
            content: `We spend much of our lives trying to control outcomes: our careers, 
our relationships, our futures. We plan, we strategize, we attempt to shape 
reality to our desires. Yet so much remains beyond our control.

The Stoics understood this paradox: we can control our responses, our attitudes, 
our actionsâ€”but not their outcomes. The world is too complex, too interconnected, 
too unpredictable for complete control.

Perhaps wisdom lies not in controlling everything, but in learning to navigate 
uncertainty with grace. To do our best, to act with integrity, and then to 
accept whatever comesâ€”not with resignation, but with equanimity.

In letting go of the illusion of control, we may find a deeper kind of freedom: 
the freedom to be present, to respond authentically, to flow with life rather 
than against it.`,
          },
          {
            title: "The Search for Authenticity",
            content: `In a world of curated identities and performative selves, authenticity 
becomes both precious and elusive. What does it mean to be authentic? To be true 
to oneself? But which self? We contain multitudes.

Perhaps authenticity is not about finding a fixed, essential self, but about 
the process of becomingâ€”of choosing who we want to be, moment by moment, 
with awareness and intention.

It requires courage: to show up as we are, not as we think we should be. 
To speak our truth, even when it's uncomfortable. To live according to 
our values, even when it's inconvenient.

Authenticity is not about perfection, but about honestyâ€”with ourselves 
and with others. It's about embracing our contradictions, our flaws, 
our humanity.`,
          },
        ],
      };

      function initPhilosophyRoom() {
        displayPhilosophy(
          state.currentPhilosophyCategory,
          state.currentPhilosophyIndex
        );
        updateCategoryTabs();
      }

      function getCurrentPhilosophyList() {
        return philosophyData[state.currentPhilosophyCategory] || [];
      }

      function displayPhilosophy(category, index) {
        const philosophyDisplay = document.getElementById("philosophy-display");
        const list = getCurrentPhilosophyList();
        const item = list[index];
        if (!item) return;

        let html = "";

        if (category === "quotes") {
          html = `
            <div class="philosophy-quote">
              <div class="quote-text">${item.text}</div>
              <div class="quote-author">â€” ${item.author}</div>
              <div class="quote-philosopher">${item.philosopher}</div>
            </div>
          `;
        } else if (category === "questions") {
          html = `
            <div class="philosophy-question">
              <div class="question-text">${item.question}</div>
              <div class="question-prompt">${item.prompt}</div>
            </div>
          `;
        } else if (category === "reflections") {
          html = `
            <div class="philosophy-reflection">
              <div class="reflection-title">${item.title}</div>
              <div class="reflection-content">${item.content}</div>
            </div>
          `;
        }

        philosophyDisplay.innerHTML = html;
        philosophyDisplay.scrollTop = 0;
      }

      function updateCategoryTabs() {
        document.querySelectorAll(".category-tab").forEach((tab) => {
          if (tab.dataset.category === state.currentPhilosophyCategory) {
            tab.classList.add("active");
          } else {
            tab.classList.remove("active");
          }
        });
      }

      document
        .getElementById("save-santa-btn")
        ?.addEventListener("click", () => {
          AudioSys.init();
          AudioSys.sfx.success();
          // Check if all levels completed
          const allCompleted =
            localStorage.getItem("level_1_completed") &&
            localStorage.getItem("level_2_completed") &&
            localStorage.getItem("level_3_completed") &&
            localStorage.getItem("level_4_completed") &&
            localStorage.getItem("level_5_completed");

          if (allCompleted || state.currentRoom === "success") {
            localStorage.setItem("christmas_unlocked", "true");
            switchRoom("room-christmas");
          } else {
            alert("Complete all levels first to save Santa!");
            AudioSys.sfx.error();
          }
        });

      document.querySelectorAll(".category-tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          state.currentPhilosophyCategory = tab.dataset.category;
          state.currentPhilosophyIndex = 0;
          updateCategoryTabs();
          displayPhilosophy(
            state.currentPhilosophyCategory,
            state.currentPhilosophyIndex
          );
          AudioSys.sfx.type();
        });
      });

      document
        .getElementById("prev-philosophy")
        ?.addEventListener("click", () => {
          const list = getCurrentPhilosophyList();
          if (state.currentPhilosophyIndex > 0) {
            state.currentPhilosophyIndex--;
          } else {
            state.currentPhilosophyIndex = list.length - 1;
          }
          displayPhilosophy(
            state.currentPhilosophyCategory,
            state.currentPhilosophyIndex
          );
          AudioSys.sfx.type();
        });

      document
        .getElementById("next-philosophy")
        ?.addEventListener("click", () => {
          const list = getCurrentPhilosophyList();
          if (state.currentPhilosophyIndex < list.length - 1) {
            state.currentPhilosophyIndex++;
          } else {
            state.currentPhilosophyIndex = 0;
          }
          displayPhilosophy(
            state.currentPhilosophyCategory,
            state.currentPhilosophyIndex
          );
          AudioSys.sfx.type();
        });

      document
        .getElementById("random-philosophy")
        ?.addEventListener("click", () => {
          const list = getCurrentPhilosophyList();
          state.currentPhilosophyIndex = Math.floor(
            Math.random() * list.length
          );
          displayPhilosophy(
            state.currentPhilosophyCategory,
            state.currentPhilosophyIndex
          );
          AudioSys.sfx.success();
        });
    </script>
  </body>
</html>
